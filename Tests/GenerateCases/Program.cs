using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;

namespace GenerateCases
{
	/// <summary>
	/// Some test suites are using the codes generated by this program, for what in openapi-directory.
	/// </summary>
	class Program
	{
		static void Main(string[] args)
		{
			Console.WriteLine("Read a text file in args1 to generate cases into file defined in args2.");
			if (args.Length < 2)
			{
				Console.WriteLine("Need a text file path and an output file path.");
				return;
			}

			var filePath = args[0]; // generate through C:\VsProjects\Study\openapi-directory20240114\APIs>dir openapi.yaml /b /s >> c:\temp\files.txt
			var outputPath = args[1];
			var fileNames = File.ReadAllLines(filePath);
			//baseName is used to path manipulation from the arg1 file contents
			//var baseName = @"openapi-directory\APIs\";
			var baseName = @"openapi-directory20240114\APIs\";

			// convert each C:\VsProjects\Study\openapi-directory20240114\APIs\1password.com\events\1.2.0\openapi.yaml to 
			var testFileNames = fileNames.Select(fileName => fileName[(fileName.IndexOf(baseName, StringComparison.InvariantCultureIgnoreCase) + baseName.Length)..]).ToList();

			File.WriteAllLines(outputPath, testFileNames.Select(d =>
			{
				var funcNameSuffix = RefinePropertyName(d);
				var forNewtonSoftAndSystemTextJson = $@"
		[Fact]
		public void Test_{funcNameSuffix}()
		{{
			helper.GenerateFromOpenApiAndBuild(@""..\..\..\..\{baseName}{d}"");
		}}

		[Fact]
		public void Test_{funcNameSuffix}_SystemTextJson()
		{{
			helper.GenerateFromOpenApiAndBuild(@""..\..\..\..\{baseName}{d}"", new Settings(){{UseSystemTextJson = true}});
		}}";

				var forNewtonSoft = $@"
		[Fact]
		public void Test_{funcNameSuffix}()
		{{
			helper.GenerateFromOpenApiAndBuild(@""..\..\..\..\{baseName}{d}"");
		}}";
				return forNewtonSoft;
			}));
		}

		static string RefinePropertyName(string s)
		{
			if (String.IsNullOrEmpty(s))
			{
				return s;
			}

			return s.Replace("\\", "_").Replace("$", "").Replace(':', '_').Replace('-', '_').Replace('.', '_')
				.Replace('[', '_').Replace(']', '_').Replace('(', '_').Replace(')', '_').Replace('/', '_').Replace('#', '_')
				.Replace(' ', '_').Replace('+', '_').Replace('~', '_');
		}
	}

}
